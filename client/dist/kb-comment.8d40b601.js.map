{"version":3,"sources":["comment-component.ts","time-ago.ts","timeline-component.ts","kb-comment.ts"],"names":[],"mappings":";;AGAA;;AACA;;AACA,AFFA,IEEA,AFFM,SEEN,CFFgB,EEEhB,CFFmB,CAAC,IAAD,EAAO,GAAP,CEEnB,CFF+B,OAAO,EAAnB,EAAuB,GAAvB,EAA4B,OAAO,EAAP,GAAY,EAAxC,EAA4C,GAA5C,EAAiD,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAlE,EAAsE,GAAtE,EAA2E,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,CAAjG,EAAoG,GAApG,EAAyG,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,EAA/H,EAAmI,GAAnI,CAAnB;AEYE,AFVF,ACFA,IDEM,OEUJ,MFViB,GEUjB,AFVgD,GEUhD;AAAA,AFVkD,EAAA,KAAK,CEUvD,CFVyD,IEUzD,GAAA,AFVgD,IEUhD;AFVkE,ACDpE,EDCoE,GAAG,EAAE,SAAvB;AEIxC,AFJ0E,EAAA,IAAI,EAAE,CEIhF,MAAA,GAA0B;AAChC,AFL8C,ACAlD,CDAA,GCAA,ECKI,KAAK,EAAE,OADyB,GDJpC,GAAA,YAAA;ACMI,ADFF,MCEE,KDFF,ECES,EAAE,EAFuB,aDAlC,CAA2B,MAA3B,EAAkD;ACGhD,AFLE,ACEJ,MCGE,EDHF,CDFc,EEKP,EAAE,ADHT,GDFI,ACEJ,CDFsB,GCEtB,EDFI,EAA+B;AEED,AFDnC,KECS,CFDL,IAAI,GAAQ,IAAI,IAAJ,CAAS,KAAT,CAAhB;AEQG,AFPF,ACA2B,MDArB,GEOC,ADPoB,IDAd,ECAc,CDAX,EEOd,ADPyB,EDAP,CEOD,GFPH,ACAW,GDAA,EEOA,CAAC,IFPZ,KAAuB,IAAI,CEOxB,CAAwB,EFPJ,CAAS,KAAT,EAAgB,EEOpC,CAAjB,IFPqC,EAAvC;ACFQ,SAAA,OAAA,GAAmB,KAAnB;ACUN,AFPF,ACAE,MDAE,EEOE,CDPC,ICOI,AFPA,GAAG,ACAZ,GAAe,CDAjB,EEOE,AFPkB,EEOE,GDPG,CAAC,aAAT,CAAuB,KAAvB,CAAf;ACQE,AFPF,ACAA,SAAK,ECOE,AFPA,IAAP,CCAA,CAAa,GCOX,CAAe,KDPjB,GAAyB,CCOvB,GAA2B,aDP7B,SCOE;AACA,AFPH,ACAC,SAAK,ECOE,MAAL,CAAY,EDPd,GCOE,ADPiB,GCOG,CDPC,ICOI,SAAL,CAAe,OAAf,CAAuB,KAAvB,IAAgC,KDPnC,CAAuB,CCOxC,IDP6C,MAA5B,CAAnB;ACQE,ADPF,SAAK,ECOE,KDPP,CCOE,ADPW,CCOC,OAAZ,GAAsB,KAAK,ADP7B,CAA8B,OAA9B,CCOwB,CAAe,ADPA,OCOf,CAAuB,EDPP,CCOhB,IAA8B,ADPf,ECOrC,ADPkD;ACQlD,AFRJ,MAAI,CAAC,GAAG,CEQC,AFRT,MEQI,CAAY,KAAZ,GAAoB,KAAK,SAAL,CAAe,OAAf,CAAuB,KAAvB,IAAgC,QAAQ,CAAC,QAA7D;AACA,WAAK,IAAL,GAAY,IAAZ,CAAiB,YAAA;AHnBvB,ACWE,ACAI,IFXA,KCWG,CAAC,ACAA,GDAG,CAAJ,EDXS,AEWF,CDAC,EDXY,AEWG,KAAK,CAAC,EDAX,CAAC,GCAtB,GDAG,EDXT,ECWsC,OAAO,GAAG,GAAV,GAAgB,UAAU,CAAC,CAAC,GAAG,CAAL,CAA9D,EAAuE;AACrE,IAAA,CAAC,IAAI,CAAL;ADXJ,AGmBQ,AFPL,ACDG,IFXN,IGmBQ,EDRE,GCQE,CAAC,EDRG,CAAC,KFXjB,GAAA,CEWU,ICQF,ADRsB,GCQE,IHnBhC,AGmBoC,IDR9B,EAAqC,8BCQX,CAAuB,KAAI,CAAC,MAA5B,CAAxB;AHPN,AGQM,ADRA,SCQA,EHRN,AGQM,CDRA,CAAA,CCQA,CDRA,GAAI,CCQA,CAAC,IDRK,CAAC,IFAjB,AGQM,CHRqB,KGQP,ADRd,CFAN,EAAkD,CGQ5C,EDRqB,ECQP,EAAA,ADRd,IAAqB,CCQP,CDRO,ICQP,CAAd,ADRqB,GCQP,EDRO,CAArB,ECQc,CAAd,ADRqB,GCQP,EAAA,ADRO,CCQL,ADRhB,GAAqB,EAAA,CAAE,KCQT,CAAc,EDRP,CAAW,ECQA,CAAC,EDRG,CAAC,WAAL,CAAiB,CCQrB,CAAsB,KDR7B,CAArB,CCQc,CAAd,ADR2D;ACS3D,AFPN,ACDQ,MDCF,EEOA,GDRE,ECQE,AFPG,ACDL,CCQG,EFPK,ACDR,MAAM,CAAC,GDCW,CAAC,CAAD,CAA1B,EEOM,EDRE,CCQuB,IAAI,CDRV,IAAjB,IAAiB,E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AAxC,EAAyE,KAAzE;AAEA,AGbM,ADRD,ECQC,ADRD,MFqBD,GGbE,CHaE,AGbF,GHawB,IAAI,CAAC,CGb7B,ADRD,CCQC,ADRD,GFqByB,CAAW,AGbnC,GAAR,EDRO,CFqB0C,AErB1C,CFqB2C,MErB3C,ECQP,CDRA,GFqB2C,CAAoB,MErBhD,CFqB4B,CAA4B,EErBvE,EAA+B,QFqBY,KAA6C,MAAxD,CAA9B;AGZA,ADTF,QAAA,GCSS,EDTT,GAAA,ECSgB,CAAC,CDTjB,ECSS,CAAY,CAAC,KAAK,SAAL,EAAD,EAAmB,KAAK,WAAL,CAAiB,sCAAjB,CAAnB,EAA6E,KAAK,WAAL,CAAiB,6DAAjB,CAA7E,EAA8J,KAAK,WAAL,CAAiB,4DAAjB,CAA9J,CAAZ,CAAP;AHaA,AGZD,GAFO,KHcF,IAAJ,EAAU;AACR,AEvBW,QAAA,GFuBN,CEvBM,KAAA,KAAA,CAAA,CFuBX,CAAmB,AEvBR,KFuBX,GAA2B,IAAI,CAAC,QAAhC;AACA,AGZI,ADZO,ECYP,IDZO,IAAA,CFwBN,AGZD,CAAA,CDZO,CAAA,MFwBX,CAAe,AGZX,CAAA,IHYJ,GAAuB,EGZnB,EHYuB,CAAC,AGZhC,IHYI,QGZJ;AHaI,AGbJ,ADZ+B,QCY/B,GHaS,EGbT,GAAA,IHaI,AGbJ,CHamB,KAAf,GAAuB,IAAI,CAAC,IAA5B;AACD;AACF,AGdC,ADZA,QAAI,GCYG,EDZE,ECYE,KDZP,ECYG,CAAY,CDZC,IAApB,EAA0B,GCYN,OAAD,EAAQ;AACzB,ADZF,SAAK,CCYG,IAAI,EDZZ,CCYe,EDZA,IAAf,ECYuB,CAAC,aAAT,CAAuB,MAAvB,CAAb;AHeG,AGdH,ADZF,EF0BK,IGdH,GDZG,CCYC,CAAC,GAAL,EDZF,CCYa,ADZA,GF0BR,CAAA,KE1BL,GCYE,ADZuB,CF0BpB,CAAA,QAAA,GAAP,UAAgB,WAAhB,EAAqC,EE1BnC;AF2BA,AGdE,ADZF,MCYE,EDZE,CF0BC,CGdC,CAAC,GDZG,EF0BV,CE1Ba,EF0BE,IGdb,CAAkB,MHcpB,OGdE,EAAiC,WAAjC;AHeH,AGdG,ADZA,GFwBG,GGZH,ADZA,ICYI,CAAC,ADZA,EAAE,ICYP,CDZY,ECYE,IDZP,CAAY,ECYnB,GDbW;ACcX,ADZA,MCYA,ADZA,ICYI,ADZA,CCYC,CDZD,GCYJ,GAAY,aAAW,KAAI,CAAC,MAAL,CAAY,KAAvB,GAA4B,MAAxC;AHeI,AGdJ,ADfW,EF6BP,GE7BN,CCeE,QAAQ,CAAC,IAAT,CHcI,AGdU,CHcV,SAAA,CAAA,AGdJ,CAA0B,IAA1B,GHcI,GAAR,YAAA;AACE,AGdC,ADZD,IAAA,CCKO,CAAP,EHqBI,CE1BC,CACF,EFyBK,CE1BR,CACO,CFyBuB,IEzBlB,MAAL,CAAY,OAAZ,GAAsB,OAD7B,EACsC;AF0BpC,AGdH,ADXK,GCEE,GHuBJ,AEzBE,MAAM,EFyBA,AEzBA,EFyBE,KAAK,aAAL,CAAmB,KADD;AAE5B,AE3BoC,KADtC,CF4BE,CExBC,GFwBG,CE5BN,CF4BQ,AExBA,KFwBK,KExBJ,GAAD,CFwBA,CAAe,AExBN,KFsBa;AAG5B,AGdI,ADVF,ECUE,IHcJ,AExBE,IFwBE,CGdA,ADVE,CFwBA,AGdF,ADVG,KFwBI,EExBT,ECUE,CAAA,ADVa,IFwBX,CAAe,AExBnB,MCUE,GAAR,UAAoB,GAApB,EAA+B;AHWC,AGV9B,KHUA,MGVO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAQ;AHe3B,AGdE,ADXE,IFyBJ,MAAM,AGdE,ADXA,CFyBD,EEzBI,CAAC,ECWE,EDXN,CCWS,ADXA,IFyBjB,AEzBQ,CFyBY,GGdK,ADXA,CCWC,EDXtB,CFyBJ,CAA4B,AEzBE,SCWb,CAAuB,EHcxC,EAA0C,IAAI,AGd7B,CHc8B,AGd7C,SHcwC,CAAe,IAAf,CAA1C;AACA,AGdE,ADXI,MCWJ,EDXI,GFyBN,CGdQ,CAAC,ADXC,CAAC,ECWT,GHcF,AGde,CHcf,CEzBM,CCWJ,ADXiB,MFyBnB,CAAA,EAAA,AEzBM,EF0BD,CE1B0B,GFyB/B,CAAA,CEzBmC,CF0B1B,AE1B2B,iBAAL,CAAuB,GAAG,CAAC,IAAJ,CAAS,IAAT,CAAc,OAArC,CAAzB;AF2BJ,AGfA,ADXG,MF0BH,AGfA,MAAM,CAAC,CHeC,EAAE,GGfV,GHegB,AGfA,CHeC,KAAK,CGftB,YHeiB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","file":"kb-comment.8d40b601.js","sourceRoot":"..\\src","sourcesContent":["const STORAGE_NAME: string = \"kb-comment-user\";\r\nexport class KBCommentComponent {\r\n  public element: HTMLFormElement;\r\n  private parentIdField: HTMLInputElement;\r\n  private rIdField: HTMLInputElement;\r\n  private nickNameField: HTMLInputElement;\r\n  private mailField: HTMLInputElement;\r\n  private siteField: HTMLInputElement;\r\n  private contentField: HTMLTextAreaElement;\r\n  private submitBtn: HTMLButtonElement;\r\n  private submitting: boolean = false;\r\n  private success?: Function;\r\n\r\n  public constructor(private config: KBCommentConfig) {\r\n    this.config = config;\r\n    this.element = document.createElement(\"form\");\r\n    this.element.className = \"kb-comment-form\";\r\n    this.element.action = \"javascript:\";\r\n    this.element.innerHTML = `\r\n      <input type=\"hidden\" name=\"parentId\" value=\"0\" />\r\n      <input type=\"hidden\" name=\"rId\" value=\"0\" />\r\n      <div class=\"user-info clearfix\">\r\n        <div class=\"input-col\">\r\n          <input type=\"text\" name=\"nickname\" maxlength=\"40\" placeholder=\"昵称(必填)\" required/>\r\n        </div>\r\n        <div class=\"input-col\">\r\n          <input type=\"email\" name=\"mail\" placeholder=\"邮箱(必填)\" required/>\r\n        </div>\r\n        <div class=\"input-col\">\r\n          <input type=\"url\" name=\"site\" maxlength=\"40\" placeholder=\"网址\" />\r\n        </div>\r\n      </div>\r\n      <div class=\"message\">\r\n        <textarea row=\"6\" name=\"content\" placeholder=\"请输入你的留言\" required></textarea>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button type=\"submit\">评论</button>\r\n      </div>`;\r\n    this.parentIdField = this.element.querySelector(\"input[name=parentId]\") as HTMLInputElement;\r\n    this.rIdField = this.element.querySelector(\"input[name=rId]\") as HTMLInputElement;\r\n    this.nickNameField = this.element.querySelector(\"input[name=nickname]\") as HTMLInputElement;\r\n    this.mailField = this.element.querySelector(\"input[name=mail]\") as HTMLInputElement;\r\n    this.siteField = this.element.querySelector(\"input[name=site]\") as HTMLInputElement;\r\n    this.contentField = this.element.querySelector(\"textarea\") as HTMLTextAreaElement;\r\n    this.submitBtn = this.element.querySelector(\"button[type=submit]\") as HTMLButtonElement;\r\n    this.element.querySelector(\"a.reset-reply\")?.addEventListener(\"click\", this.resetReply.bind(this));\r\n    this.element.addEventListener(\"submit\", this.onSubmitComment.bind(this), false);\r\n\r\n    let info: KBCommentUserInfo = JSON.parse(window.localStorage.getItem(STORAGE_NAME) || \"null\") as KBCommentUserInfo;\r\n    if (info) {\r\n      this.nickNameField.value = info.nickName;\r\n      this.mailField.value = info.mail;\r\n      this.siteField.value = info.site;\r\n    }\r\n  }\r\n\r\n  public setEvent(successFunc: Function) {\r\n    this.success = successFunc;\r\n  }\r\n\r\n  private getModel() {\r\n    let info: KBCommentUserInfo = {\r\n      nickName: this.nickNameField.value,\r\n      mail: this.mailField.value,\r\n      site: this.siteField.value,\r\n    };\r\n    window.localStorage.setItem(STORAGE_NAME, JSON.stringify(info));\r\n    return {\r\n      ...info,\r\n      parentId: Number(this.parentIdField.value),\r\n      rId: Number(this.rIdField.value),\r\n      content: this.contentField.value,\r\n      ip: returnCitySN.cip,\r\n      articleToken: this.config.token,\r\n    };\r\n  }\r\n\r\n  private onSubmitComment(event: Event) {\r\n    event.preventDefault();\r\n    if (this.submitting) {\r\n      return;\r\n    }\r\n    this.submitting = true;\r\n    this.submitBtn.disabled = true;\r\n    axios.post(this.config.apiBase + \"/comment\", this.getModel()).then((res: any) => {\r\n      this.submitBtn.disabled = false;\r\n      this.submitting = false;\r\n      if (res.data.code == 200) {\r\n        this.success && this.success();\r\n        this.contentField.value = \"\";\r\n      }\r\n    });\r\n    return false;\r\n  }\r\n\r\n  private resetReply() {\r\n    this.setReply(\"0\", \"0\");\r\n  }\r\n\r\n  public setReply(parentId: string, rId: string) {\r\n    this.rIdField.value = rId;\r\n    this.parentIdField.value = parentId;\r\n  }\r\n}\r\n","const thresholds = [1000, \"秒\", 1000 * 60, \"分\", 1000 * 60 * 60, \"时\", 1000 * 60 * 60 * 24, \"天\", 1000 * 60 * 60 * 24 * 7, \"周\", 1000 * 60 * 60 * 24 * 27, \"月\"];\r\n\r\nconst formatOptions: Intl.DateTimeFormatOptions = { month: \"short\", day: \"numeric\", year: \"numeric\" };\r\n\r\nexport function timeAgo(value: string) {\r\n\tlet date:Date = new Date(value);\r\n  const elapsed = new Date().getTime() - new Date(value).getTime();\r\n  if (elapsed < 5000) {\r\n    return \"刚刚\";\r\n  }\r\n  let i = 0;\r\n  while (i + 2 < thresholds.length && elapsed * 1.1 > thresholds[i + 2]) {\r\n    i += 2;\r\n  }\r\n\r\n  const divisor = thresholds[i] as number;\r\n  const text = thresholds[i + 1] as string;\r\n  const units = Math.round(elapsed / divisor);\r\n\r\n  if (units > 3 && i === thresholds.length - 2) {\r\n    return date.toLocaleDateString(undefined, formatOptions);\r\n  }\r\n  return `${units}${text}前`;\r\n}\r\n","import { KBCommentComponent } from \"./comment-component\";\r\nimport { timeAgo } from \"./time-ago\";\r\nexport class KBTimeLineComponent {\r\n  public element: HTMLDivElement;\r\n  private loading: boolean = false;\r\n  private commentComp: KBCommentComponent;\r\n  public constructor(private config: KBCommentConfig) {\r\n    this.element = document.createElement(\"div\");\r\n    this.element.className = \"kb-comment-list\";\r\n    this.commentComp = new KBCommentComponent(this.config);\r\n    this.element.addEventListener(\"click\", (event: Event) => {\r\n      let target: HTMLElement = event.target as HTMLElement;\r\n      if (target.className == \"reply-btn\") {\r\n        if (target.parentNode?.contains(this.commentComp.element)) {\r\n          target.parentNode?.removeChild(this.commentComp.element);\r\n        } else {\r\n          target.parentNode?.appendChild(this.commentComp.element);\r\n          this.commentComp.setReply(target.dataset.pid || \"\", target.dataset.rid || \"\");\r\n          this.commentComp.setEvent(() => {\r\n            target.parentNode?.removeChild(this.commentComp.element);\r\n            this.getList();\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public getList(page: number = 1) {\r\n    if (this.loading == true) return;\r\n    this.loading = true;\r\n    this.element.innerHTML = `<div class=\"loading\">loading</div>`;\r\n    let params = {\r\n      token: this.config.token,\r\n      page,\r\n    };\r\n    axios\r\n      .get(this.config.apiBase + \"/page\", {\r\n        params,\r\n      })\r\n      .then((res: any) => {\r\n        this.loading = false;\r\n        if (res.data.code == 200) {\r\n          this.element.innerHTML = this.renderCommentItem(res.data.data.records);\r\n        }\r\n      });\r\n  }\r\n\r\n  private renderCommentItem(list: KBCommentItem[], first: number = 0): string {\r\n    return list.reduce((html: string, item: KBCommentItem) => {\r\n      let pid = first == 0 ? item.id : first;\r\n      html += `\r\n\t\t\t\t<div class=\"comment-item\">\r\n\t\t\t\t\t<div class=\"comment-avatar\">\r\n\t\t\t\t\t\t<img src=\"https://s.gravatar.com/avatar/${md5(item.mail)}?s=50&d=retro&r=g\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"comment-message clear-right\">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div class=\"comment-time\">${timeAgo(item.createdAt)}</div>\r\n\t\t\t\t\t\t\t<div class=\"comment-nickname\"><a target=\"_black\" href=\"${item.site}\">${item.nickName}</a></div>\r\n\t\t\t\t\t\t</div>\r\n            <div class=\"comment-content\">${item.content}</div>\r\n            <div class=\"comment-option\"><a class=\"reply-btn\" data-rid=\"${item.id}\" data-pid=\"${pid}\" href=\"javascript:\">回复</a></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"comment-replys\">\r\n\t\t\t\t\t\t${Array.isArray(item.replys) ? this.renderCommentItem(item.replys, pid) : \"\"}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>`;\r\n      return html;\r\n    }, \"\");\r\n  }\r\n}\r\n","import { KBCommentComponent } from \"./comment-component\";\r\nimport { KBTimeLineComponent } from \"./timeline-component\";\r\nclass KBComment {\r\n  private container: HTMLElement | null;\r\n  private commentComponent?: KBCommentComponent;\r\n  private timelineComponent?: KBTimeLineComponent;\r\n  private config: KBCommentConfig = {\r\n    theme: \"light\",\r\n    apiBase: \"\",\r\n    token: \"light\",\r\n  };\r\n\r\n  constructor() {\r\n    this.container = document.getElementById(\"kb-comment\");\r\n    if (this.container) {\r\n      this.container.className = \"kb-comment-container\";\r\n      this.config.theme = this.container.dataset.theme || \"light\";\r\n      this.config.apiBase = this.container.dataset.api || \"\";\r\n      this.config.token = this.container.dataset.token || location.pathname;\r\n      this.load().then(() => {\r\n        this.commentComponent = new KBCommentComponent(this.config);\r\n        this.container?.appendChild(this.commentComponent.element);\r\n        this.timelineComponent = new KBTimeLineComponent(this.config);\r\n        this.container?.appendChild(this.timelineComponent.element);\r\n        this.timelineComponent.getList();\r\n        let self = this;\r\n        this.commentComponent.setEvent(function () {\r\n          self.timelineComponent?.getList();\r\n        });\r\n      });\r\n    } else {\r\n      console.error(\"未设定渲染容器\");\r\n    }\r\n  }\r\n\r\n  private load(): Promise<any> {\r\n    return Promise.all([this.loadTheme(), this.loadLibrary(\"http://pv.sohu.com/cityjson?ie=utf-8\"), this.loadLibrary(\"https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js\"), this.loadLibrary(\"https://cdn.jsdelivr.net/npm/js-md5@0.7.3/build/md5.min.js\")]);\r\n  }\r\n\r\n  private loadTheme() {\r\n    return new Promise((resolve) => {\r\n      const link = document.createElement(\"link\");\r\n      link.rel = \"stylesheet\";\r\n      link.setAttribute(\"crossorigin\", \"anonymous\");\r\n      link.onload = resolve;\r\n      link.href = `/themes/${this.config.theme}.css`;\r\n      document.head.appendChild(link);\r\n    });\r\n  }\r\n\r\n  private loadLibrary(url: string) {\r\n    return new Promise((resolve) => {\r\n      const script = document.createElement(\"script\");\r\n      script.src = url;\r\n      script.onload = resolve;\r\n      document.body.appendChild(script);\r\n    });\r\n  }\r\n}\r\n\r\nnew KBComment();\r\n"]}