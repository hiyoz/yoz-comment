{"version":3,"sources":["deparam.ts","client.ts"],"names":[],"mappings":"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","file":"client.js","sourceRoot":"..\\client","sourcesContent":["export function deparam(query: string): Record<string, string> {\r\n  let match: RegExpExecArray | null;\r\n  const plus = /\\+/g;\r\n  const search = /([^&=]+)=?([^&]*)/g;\r\n  const decode = (s: string) => decodeURIComponent(s.replace(plus, ' '));\r\n  const params: Record<string, string> = {};\r\n  // tslint:disable-next-line:no-conditional-assignment\r\n  while (match = search.exec(query)) {\r\n    params[decode(match[1])] = decode(match[2]);\r\n  }\r\n  return params;\r\n}\r\n\r\nexport function param(obj: Record<string, string>) {\r\n  const parts = [];\r\n  for (const name in obj) {\r\n    if (obj.hasOwnProperty(name) && obj[name]) {\r\n      parts.push(`${encodeURIComponent(name)}=${encodeURIComponent(obj[name])}`);\r\n    }\r\n  }\r\n  return parts.join('&');\r\n}","import { param } from \"./deparam\";\r\nimport { ResizeMessage } from \"./measure\";\r\nlet script = document.currentScript as HTMLScriptElement;\r\nif (script === undefined) {\r\n  script = document.querySelector(\"script#YozComment\") as HTMLScriptElement;\r\n}\r\n\r\nlet attrs: Record<string, string> = {};\r\nfor (let i = 0; i < script.attributes.length; i++) {\r\n  let attr = script.attributes.item(i)!;\r\n  attrs[attr.name.replace(/^data-/, \"\")] = attr.value;\r\n}\r\nattrs.origin = location.origin;\r\n// attrs.pageUrl = location.href;\r\n// attrs.pageTitle = document.title;\r\ndocument.head.insertAdjacentHTML(\r\n  \"afterbegin\",\r\n  `<style>\r\n\t\t\t.yozComment {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmax-width: 760px;\r\n\t\t\t\tmargin-left: auto;\r\n\t\t\t\tmargin-right: auto;\r\n\t\t\t}\r\n\t\t\t.yozComment-frame {\r\n\t\t\t\tcolor-scheme: light;\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tleft: 0;\r\n\t\t\t\tright: 0;\r\n\t\t\t\twidth: 1px;\r\n\t\t\t\tmin-width: 100%;\r\n\t\t\t\tmax-width: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tborder: 0;\r\n\t\t\t}\r\n\t\t</style>`\r\n);\r\n// let origin = script.src.replace(/client.js$/, \"index.html\");\r\nlet pathArray = script.src.split(\"/\");\r\nlet urlOrigin = pathArray[0] + \"//\" + pathArray[2];\r\nlet url = script.src.replace(/client.js$/, \"index.html\");\r\nscript.insertAdjacentHTML(\r\n  \"afterend\",\r\n  `<div class=\"yozComment\">\r\n    <iframe class=\"yozComment-frame\" title=\"Comments\" scrolling=\"no\" src=\"${url}?${param(attrs)}\" loading=\"lazy\"></iframe>\r\n  </div>`\r\n);\r\nconst container = script.nextElementSibling as HTMLDivElement;\r\nscript.parentElement!.removeChild(script);\r\n\r\n// adjust the iframe's height when the height of it's content changes\r\naddEventListener(\"message\", (event) => {\r\n  if (event.origin !== urlOrigin) {\r\n    return;\r\n  }\r\n  const data = event.data as ResizeMessage;\r\n  if (data && data.type === \"resize\" && data.height) {\r\n    container.style.height = `${data.height}px`;\r\n  }\r\n});\r\n"]}